<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.devwu.com","root":"/","scheme":"Mist","version":"8.0.0-rc.3","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="每天进步一点。">
<meta property="og:type" content="website">
<meta property="og:title" content="Geek5Nan">
<meta property="og:url" content="http://blog.devwu.com/page/2/index.html">
<meta property="og:site_name" content="Geek5Nan">
<meta property="og:description" content="每天进步一点。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Geek5Nan">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://blog.devwu.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Geek5Nan</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-49244994-2"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-49244994-2');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Geek5Nan</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2018/06/25/coding-marathon-04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/25/coding-marathon-04/" class="post-title-link" itemprop="url">编程马拉松 Day04 希尔排序、归并排序、快速排序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-24 22:53:17" itemprop="dateCreated datePublished" datetime="2018-06-24T22:53:17Z">2018-06-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E9%A9%AC%E6%8B%89%E6%9D%BE/" itemprop="url" rel="index"><span itemprop="name">编程马拉松</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/06/25/coding-marathon-04/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/25/coding-marathon-04/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文将介绍三个高级排序算法</p>
<ol>
<li>希尔排序</li>
<li>归并排序</li>
<li>快速排序</li>
</ol>
<h3 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h3><p>希尔排序(Shell’s Sort)的名称源于它的发明者<code>Donald Shell</code>，这是一种基于<strong>插入排序</strong>算法的改进。在处理大规模乱序数组时，插入排序的速度不容乐观，因为它只能一点一点的将元素从数组的一端移动到另一端。希尔排序为了加快速度，对插入排序进行了小幅的<strong>改动</strong>，开始时将数组<strong>划分</strong>为m相邻的若干个子数组，并对每一个子数组进行插入排序，然后缩小m的值再次划分并排序，循环往复直到完成<code>m = 1</code>时的最后一次插入排序，此时整个数组有序。</p>
<p>插入排序，每次将第k个元素插入前k-1个元素之间。<br><img src="/uploads/InsertSortExample.png" alt="插入排序示例"><br>希尔排序示例，每次将第mk个元素插入到k,2k,3k…mk这m个元素之间。<br><img src="/uploads/ShellSortExample.png" alt="希尔排序示例"></p>
<p>希尔排序的思路是使数组中任意间隔为m的元素都是有序的，这样的数组被称为m有序数组。一般m的初始值较大，以便我们可以将元素移动到很远的地方，随着希尔排序的进行，m会逐渐变小，当收敛到1时希尔排序完全退化为插入排序，从而完成最后的排序动作。<br>希尔排序高效的原因是它完全利用了<strong>插入排序的特点</strong>：</p>
<ol>
<li>初始时，m值较大，子数组元素个数较小（小规模数据）</li>
<li>初始前几次，构造出了m有序子数组（部分有序）</li>
</ol>
<p>希尔排序的过程如下图所示<br><img src="/uploads/ShellSort1.gif" alt="希尔排序完整版"></p>
<h4 id="希尔排序代码"><a href="#希尔排序代码" class="headerlink" title="希尔排序代码"></a>希尔排序代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(Integer arr[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> before = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//获取的m值，与数组长度相关</span></span><br><span class="line">    <span class="comment">//子数组的部分有序的程度取决于m的值，而如何选取m的值是一项数学难题，在这里我们采用`1 4 13 40 121 364`这样的序列来作为希尔排序中m的值。</span></span><br><span class="line">    <span class="keyword">while</span> (m &lt; arr.length / <span class="number">3</span>) m = <span class="number">3</span> * m + <span class="number">1</span>;<span class="comment">//1 4 13 40 121 364...</span></span><br><span class="line">    <span class="keyword">while</span> (m &gt;= <span class="number">1</span>) &#123;<span class="comment">//每轮循环结束时,m缩小3倍，直到收敛为1时，退化为插入排序</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = m; i &lt; arr.length; i++) &#123;<span class="comment">//从m开始</span></span><br><span class="line">            <span class="keyword">int</span> temp = arr[i];<span class="comment">//采用temp存放待插入元素</span></span><br><span class="line">            <span class="keyword">int</span> j = i;</span><br><span class="line">            <span class="comment">//取 arr[i],arr[i-m],arr[i-2m] ... 做插入排序</span></span><br><span class="line">            <span class="keyword">while</span> (j &gt;= m &amp;&amp; temp &lt; arr[j - m]) &#123;</span><br><span class="line">                arr[j] = arr[j - m];</span><br><span class="line">                j -= m;</span><br><span class="line">            &#125;</span><br><span class="line">            arr[j] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        m = m / <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> after = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"希尔排序耗时："</span> + (after - before) + <span class="string">"ms"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与上一篇文章中的优化插入排序相比，希尔排序的优势还是很明显的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">20W条数据</span><br><span class="line">插入排序耗时：   2776ms</span><br><span class="line">希尔排序耗时：     25ms</span><br></pre></td></tr></table></figure>


<h3 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3><p>归并排序的核心是<strong>归并</strong>操作，即将两个有序的数组合并为一个有序数组，归并过程如下所示</p>
<table>
<thead>
<tr>
<th>步骤</th>
<th>sortedArr1</th>
<th>sotedArr2</th>
<th>resultArr</th>
</tr>
</thead>
<tbody><tr>
<td>Init</td>
<td>1 3 5 8</td>
<td>2 6 9 10</td>
<td>-</td>
</tr>
<tr>
<td>Step1</td>
<td><font color=blue><del>1</del></font> 3 5 8</td>
<td>2 6 9 10</td>
<td>1</td>
</tr>
<tr>
<td>Step2</td>
<td><font color=blue><del>1</del></font> 3 5 8</td>
<td><font color=red><del>2</del></font> 6 9 10</td>
<td>1 2</td>
</tr>
<tr>
<td>Step3</td>
<td><font color=blue><del>1 3</del></font> 5 8</td>
<td><font color=red><del>2</del></font> 6 9 10</td>
<td>1 2 3</td>
</tr>
<tr>
<td>Step4</td>
<td><font color=blue><del>1 3 5</del></font> 8</td>
<td><font color=red><del>2</del></font> 6 9 10</td>
<td>1 2 3 5</td>
</tr>
<tr>
<td>Step5</td>
<td><font color=blue><del>1 3 5</del></font> 8</td>
<td><font color=red><del>2 6</del></font> 9 10</td>
<td>1 2 3 5 6</td>
</tr>
<tr>
<td>Step6</td>
<td><font color=blue><del>1 3 5 8</del></font></td>
<td><font color=red><del>2 6</del></font> 9 10</td>
<td>1 2 3 5 6 8</td>
</tr>
<tr>
<td>Step7</td>
<td><font color=blue><del>1 3 5 8</del></font></td>
<td><font color=red><del>2 6 9</del></font> 10</td>
<td>1 2 3 5 6 8 9</td>
</tr>
<tr>
<td>Step8</td>
<td><font color=blue><del>1 3 5 8</del></font></td>
<td><font color=red><del>2 6 9 10</del></font></td>
<td>1 2 3 5 6 8 9 10</td>
</tr>
</tbody></table>
<p>有了归并操作后，只需将待排序数组（递归地）<strong>划分</strong>为两半，直到每半只有一个元素时，便可将其视作有序的，从而将其合并为一个包含两个元素的有序数组，以此类推，最终将整个数组排序。<br><img src="/uploads/mergeSortDemo.png" alt="归并排序Demo"></p>
<p>归并排序的过程如下图所示<br><img src="/uploads/MergeSort1.gif" alt="归并排序完整版"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(Integer arr[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> before = System.currentTimeMillis();</span><br><span class="line">    mergeSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">long</span> after = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"归并排序耗时："</span> + (after - before) + <span class="string">"ms"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(Integer arr[], <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (high &lt;= low) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (low + high) / <span class="number">2</span>;</span><br><span class="line">    mergeSort(arr, low, mid);<span class="comment">//将左半部分排序</span></span><br><span class="line">    mergeSort(arr, mid + <span class="number">1</span>, high);<span class="comment">//将右半部分排序</span></span><br><span class="line">    merge(arr, low, mid, high);<span class="comment">//对左右两个有序数组进行归并操作</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(Integer arr[], <span class="keyword">int</span> low, <span class="keyword">int</span> mid, <span class="keyword">int</span> high)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = low; <span class="comment">//设i为左边有序数组的首索引</span></span><br><span class="line">    <span class="keyword">int</span> j = mid + <span class="number">1</span>;<span class="comment">//设j为右边有序数组的首索引</span></span><br><span class="line">    <span class="comment">//将原数组先拷贝一份，在合并中使用</span></span><br><span class="line">    Integer aux[] = Arrays.copyOf(arr, arr.length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = low; k &lt;= high; k++) &#123;</span><br><span class="line">        <span class="comment">//若i的索引&gt;mid，表明左边元素均已并入新的有序数组，此时只需将右边有序数组的剩余元素并入新的有序数组</span></span><br><span class="line">        <span class="keyword">if</span> (i &gt; mid) &#123;</span><br><span class="line">            arr[k] = aux[j++];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j &gt; high) &#123;<span class="comment">//若i的索引&gt;mid，表明左边元素均已并入新的有序数组，此时只需将右边有序数组的剩余元素并入新的有序数组</span></span><br><span class="line">            arr[k] = aux[i++];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (aux[j] &lt; aux[i]) &#123;<span class="comment">//取左右有序数组中为并入新的有新数组中的的较小元素，将其并入到新的有序数组中</span></span><br><span class="line">            arr[k] = aux[j++];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            arr[k] = aux[i++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于含有N个元素的数组，需要logN次<strong>划分</strong>，每次合并分别需比较2,4,…,N/4,N/2,N次。因此归并排序的时间复杂度为 $O(N*log_2 N))$</p>
<h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><p>快速排序是应用最广泛的排序算法，在各SDK里边都有出现。与归并排序相似，快排也需要对原数组进行<strong>划分</strong>，然后对划分后的两个子数组单独的进行排序。不同的是，快排在划分时不是简单的二等分，而是与原数组有关。</p>
<p>快速排序步骤</p>
<ol>
<li>取数组中的第一个元素的值作为参考值v</li>
<li>从前向后扫描，找到第一个比v大的元素，并记录其索引为i</li>
<li>从后向前扫描，找到第一个比v小的元素，并记录其索引为j</li>
<li>交换i和j的位置，分别从i和j的位置继续步骤2-3，直到<code>i&gt;=j</code>时结束扫描，并交换数组首元素与索引为j的元素。此时我们将开始时的首元素调整到的j的位置，且j之前的元素均比j小，j之后的元素均比j大。而j就是我们得到的划分位置。</li>
<li>以j为中心，将数组划分为两个子数组，分别重复步骤1-4。</li>
</ol>
<p>快速排序的过程如下图所示，图的红线即为每次的划分时所用的参考值。<br><img src="/uploads/QuickSort1.gif" alt="快速排序完整版"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(Integer arr[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> before = System.currentTimeMillis();</span><br><span class="line">    quickSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">long</span> after = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"快速排序耗时："</span> + (after - before) + <span class="string">"ms"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(Integer arr[], <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (high &lt;= low) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> j = partition(arr, low, high);<span class="comment">//获取切分点</span></span><br><span class="line">    quickSort(arr, low, j - <span class="number">1</span>);<span class="comment">//对左子数组进行排序</span></span><br><span class="line">    quickSort(arr, j + <span class="number">1</span>, high);<span class="comment">//对右子数组进行排序</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(Integer arr[], <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> v = arr[low];<span class="comment">//将首元素作为参考值</span></span><br><span class="line">    <span class="keyword">int</span> i = low + <span class="number">1</span>;<span class="comment">//记录当前数组的起点</span></span><br><span class="line">    <span class="keyword">int</span> j = high;<span class="comment">//记录当前数组的终点</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (arr[i] &lt;= v &amp;&amp; i &lt; high) &#123;</span><br><span class="line">            i++;<span class="comment">//若arr[i]不大于v，则向后扫描</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (arr[j] &gt;= v &amp;&amp; j &gt; low) &#123;</span><br><span class="line">            j--;<span class="comment">//若arr[j]不小于v，则向前扫描</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= j) <span class="keyword">break</span>;</span><br><span class="line">        swap(arr, i, j);</span><br><span class="line">    &#125;</span><br><span class="line">    swap(arr, low, j);</span><br><span class="line">    <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>以上所讲的三个排序算法中，都用到了<strong>划分</strong>这一操作。在算法学习中，我们把通过把大规模问题划分为小规模问题，分而治之的策略称为<strong>分治策略</strong>，也叫<strong>分治法</strong>。在分治法中经常会递归地求解一个问题，在每层递归中采用如下三个步骤：</p>
<ol>
<li><strong>分解</strong>：将问题划分为一些子问题，子问题的形式与原问题一样，只是规模更小</li>
<li><strong>解决</strong>：递归的求解出子问题。如果子问题的规模足够小，则停止递归，直接求解</li>
<li><strong>合并</strong>：将子问题的解组合成原问题的解</li>
</ol>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><table>
<thead>
<tr>
<th>排序算法</th>
<th>问题规模（待排序元素个数）</th>
<th>解题时间1</th>
<th>解题时间2</th>
<th>解题时间3</th>
<th>平均解题时间</th>
</tr>
</thead>
<tbody><tr>
<td>希尔排序</td>
<td>10W</td>
<td>30ms</td>
<td>34ms</td>
<td>32ms</td>
<td>32ms</td>
</tr>
<tr>
<td>快速排序</td>
<td>10W</td>
<td>24ms</td>
<td>23ms</td>
<td>45ms</td>
<td>30.6ms</td>
</tr>
<tr>
<td>归并排序</td>
<td>10W</td>
<td>4885ms</td>
<td>4908ms</td>
<td>4822ms</td>
<td>4871.7ms</td>
</tr>
<tr>
<td>希尔排序</td>
<td>50W</td>
<td>174ms</td>
<td>183ms</td>
<td>196ms</td>
<td>184.3ms</td>
</tr>
<tr>
<td>快速排序</td>
<td>50W</td>
<td>117ms</td>
<td>124ms</td>
<td>122ms</td>
<td>121ms</td>
</tr>
<tr>
<td>希尔排序</td>
<td>100W</td>
<td>450ms</td>
<td>434ms</td>
<td>413ms</td>
<td>432.3ms</td>
</tr>
<tr>
<td>快速排序</td>
<td>100W</td>
<td>217ms</td>
<td>268ms</td>
<td>235ms</td>
<td>240ms</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2018/06/24/coding-marathon-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/24/coding-marathon-03/" class="post-title-link" itemprop="url">编程马拉松 Day03 冒泡排序、选择排序、插入排序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-23 16:39:57" itemprop="dateCreated datePublished" datetime="2018-06-23T16:39:57Z">2018-06-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E9%A9%AC%E6%8B%89%E6%9D%BE/" itemprop="url" rel="index"><span itemprop="name">编程马拉松</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/06/24/coding-marathon-03/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/24/coding-marathon-03/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>排序是科学计算和数据处理必不可少的一个环节，今天起我们就来聊聊排序。</p>
<p>本文将介绍三个初级排序算法</p>
<ol>
<li>冒泡排序</li>
<li>选择排序</li>
<li>插入排序</li>
</ol>
<p>先来看下图这样的一组初始数据，每一个矩形的高度都与其下方的数字成比例，数值越大则矩形的高度就越高。</p>
<p><img src="/uploads/WX20180624-162340@2x.png" alt="初始数据"></p>
<p>假设有如下两个问题，我们该如何求解。</p>
<ul>
<li>找出最(小/大)值</li>
<li>找出第k(小/大)的值</li>
</ul>
<p>显然，在乱序的数组中这两个问题都不太容易求解，但如果数据是有序的就会容易很多。</p>
<h3 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h3><p>冒泡排序是最容易想到的排序算法。以对N个元素的数组进行升序排序为例，其基本思路如下：</p>
<ol>
<li>从数组内的前两个元素开始，将这两个元素进行比较，如果前一个元素大于后一个元素，则交换两者的位置</li>
<li>接着取数组中的第2-3个元素进行比较，若第2个元素大于第3个元素，则交换两者的位置</li>
<li>循环往复，直到数组中的最后两个元素，此时，若第N-1个元素大于第N个元素，则交换它们的位置。经过一轮的比较与交换，我们已经得到了数组中最大的元素，并将其安置在了数组的第N位。</li>
<li>经过前三个步骤，我们将数组中最大的元素放到了第N位，下边只用排序数组中的前N-1个元素即可。此时我们将N的值减1，并判断新N的值，若新N&gt;0，则循环1-3步骤；若新N=0，则代表我们已经完成了排序。</li>
</ol>
<p>冒泡排序的过程(剪辑版)如下图所示，你也可以<a href="/uploads/BubbleSort1.gif">点击这里查看完整的冒泡排序过程</a>。<br><img src="/uploads/BubbleSort.gif" alt="冒泡排序剪辑版"></p>
<p>我们知道，水杯中出现气泡时，越大的气泡浮力越大，上升速度也就越快，最先到达水面，冒牌排序中每轮遴选较大元素放置末尾的行为与水中气泡上升的现象十分相似，因此得名冒泡排序。</p>
<h4 id="冒泡排序代码"><a href="#冒泡排序代码" class="headerlink" title="冒泡排序代码"></a>冒泡排序代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(Integer arr[])</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> compareCount = <span class="number">0</span>;<span class="comment">//比较次数</span></span><br><span class="line">        <span class="keyword">int</span> swapCount = <span class="number">0</span>;<span class="comment">//交换次数</span></span><br><span class="line">        <span class="keyword">long</span> before = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123; <span class="comment">//外层循环，与数组元素个数相关</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; arr.length - i; j++) &#123; <span class="comment">//内层循环，只需在前 n-1 个元素内进行相邻比较</span></span><br><span class="line">                compareCount++;</span><br><span class="line">                <span class="keyword">if</span> (arr[j - <span class="number">1</span>] &gt; arr[j]) &#123;</span><br><span class="line">                    swapCount++;</span><br><span class="line">                    swap(arr, j - <span class="number">1</span>, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> after = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"冒泡排序耗时："</span>+(after-before)+<span class="string">"ms,"</span>+<span class="string">"比较次数："</span>+compareCount+<span class="string">",交换次数："</span>+swapCount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用上述代码对以下两组数据排序时，其比较次数一致，仅交换次数不同。但显而易见的是，第二组本身就是有序的，也就是说上边的代码中，存在冗余比较。<br><code>3 5 1 6 10 9 11</code><br><code>1 3 5 7 9 10 11</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">原有数组 3 5 1 6 10 9 11 </span><br><span class="line">冒泡排序耗时：0ms 比较次数：21,交换次数：3</span><br><span class="line">排序后 1 3 5 6 9 10 11 </span><br><span class="line">---</span><br><span class="line">原有数组 1 3 5 6 9 10 11 </span><br><span class="line">冒泡排序耗时：0ms 比较次数：21,交换次数：0</span><br><span class="line">排序后 1 3 5 6 9 10 11</span><br></pre></td></tr></table></figure>
<p>针对这样的问题，我们可以采用如下思路对冒泡排序的代码进行优化。</p>
<ul>
<li>当某轮内循环没有发生元素交换时，表明数组已然有序，无需再进行后续的比较，此时可直接中止循环    </li>
</ul>
<h4 id="冒泡排序优化代码"><a href="#冒泡排序优化代码" class="headerlink" title="冒泡排序优化代码"></a>冒泡排序优化代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSortOpt</span><span class="params">(Integer arr[])</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> compareCount = <span class="number">0</span>;<span class="comment">//比较次数</span></span><br><span class="line">        <span class="keyword">int</span> swapCount = <span class="number">0</span>;<span class="comment">//交换次数</span></span><br><span class="line">        <span class="keyword">long</span> before = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123; <span class="comment">//外层循环，与数组元素个数相关</span></span><br><span class="line">        	<span class="keyword">boolean</span> isSwap = <span class="keyword">false</span>; <span class="comment">//交换标记，每轮外循环开始时，将其置位false</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; arr.length - i; j++) &#123; <span class="comment">//内层循环，只需在前 n-1 个元素内进行相邻比较</span></span><br><span class="line">                compareCount++;</span><br><span class="line">                <span class="keyword">if</span> (arr[j - <span class="number">1</span>] &gt; arr[j]) &#123;</span><br><span class="line">                	isSwap = <span class="keyword">true</span>;<span class="comment">//若内循环内发生交换，则将交换标志置位true</span></span><br><span class="line">                    swapCount++;</span><br><span class="line">                    swap(arr, j - <span class="number">1</span>, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!isSwap) &#123;<span class="comment">//判断循环标记，若未发生交换，则跳出循环</span></span><br><span class="line">            	<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> after = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"冒泡排序耗时："</span>+(after-before)+<span class="string">"ms,"</span>+<span class="string">"比较次数："</span>+compareCount+<span class="string">",交换次数："</span>+swapCount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">原有数组 3 5 1 6 10 9 11 </span><br><span class="line">冒泡排序耗时：0ms 比较次数：15,交换次数：3</span><br><span class="line">排序后 1 3 5 6 9 10 11 </span><br><span class="line">---</span><br><span class="line">原有数组 1 3 5 6 9 10 11 </span><br><span class="line">冒泡排序耗时：0ms 比较次数：5,交换次数：0</span><br><span class="line">排序后</span><br></pre></td></tr></table></figure>

<h3 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h3><p>选择排序的思路同样很简单，以对含有N个元素的数组进行升序排序为例，其步骤如下所示：</p>
<ol>
<li>假设首元素是最小的，并记录其索引值为minIndex，遍历数组，分别与其比较，若数组中第i个元素的数值小于第minIndex个元素的数组，则将i赋值与minIndex。</li>
<li>遍历结束后，我们得到了数值最小的元素的索引值，将其与首元素进行交换，交换后的首元素即为数组中数值最小的元素。</li>
<li>经过前边两个步骤，此时数组中可分为首元素和与第2个元素开始到末尾的N-1个元素。判断N-1，若N-1&gt;0,则将第二个元素视作首元素，重复步骤1-2；若N-1=0，则表明数组已然有序，中止循环。</li>
</ol>
<p>选择排序的过程(剪辑版)如下图所示，你也可以<a href="/uploads/SelectionSort1.gif">点击这里查看完整的选择排序过程</a>。<br><img src="/uploads/SelectionSort.gif" alt="选择排序剪辑版"></p>
<p>根据这个思路，不难写出其代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectSort</span><span class="params">(Integer arr[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> compareCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> swapCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">long</span> before = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> minIndex = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; arr.length - i; j++) &#123;</span><br><span class="line">            compareCount++;</span><br><span class="line">            <span class="keyword">if</span> (arr[j]&lt;arr[minIndex])&#123;</span><br><span class="line">                minIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (minIndex!=i)&#123;</span><br><span class="line">            swapCount++;</span><br><span class="line">            swap(arr,i,minIndex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> after = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"选择排序耗时："</span> + (after - before) + <span class="string">"ms,"</span> + <span class="string">"比较次数："</span> + compareCount + <span class="string">",交换次数："</span> + swapCount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h3><p>插入排序是我们需要了解是最后一个简单排序算法，其思路与我们打扑克牌时的起牌手法相似。</p>
<ol>
<li>假设我们用左手持牌，右手起牌，每次起牌完成后，左手中的手牌均为有序的。</li>
<li>开始起牌时，左手手牌为空，此时从牌堆顶取一张牌，直接放入左手</li>
<li>在起后边的牌时，我们拿右手中刚起到的那张新牌，与左手中的所有手牌进行比较，并放入到合适的位置。<ul>
<li>按从大到小的顺序分别拿左手中的手牌与新牌进行比较</li>
<li>在从大到小的比较过程中，若左手当前手牌比新牌大，则取交换着两张牌的位置，并以左手当前手牌作为新牌，与剩余的左手手牌进行比较</li>
<li>若左手的当前手牌小于等于新牌，则将新牌插入到当前手牌之后，并将此后的手牌依次向后挪动</li>
</ul>
</li>
</ol>
<p><img src="/uploads/QQ20180624-192914@2x.png" alt="使用插入排序来排序手中扑克牌"></p>
<p>需要注意的是，在插入排序时，我们将数组分为了两部分，一部分是”左手”中的有序子数组，另一部分是”牌堆”中无序的子数组。初始时，我们将数组中的第一个元素视作已排序子数组，并将第二个元素至最后一个元素视作无序子数组。我们每次从无序子数组中取出首元素p，从后往前分别与有序子数组中的元素q进行比较，若p小于q的数值，则将p与q交换，并继续用p与子数组中剩下的元素进行比较和交换，直到p不小q时，完成此轮插入，此时有序子数组的长度+1，无序子数组的长度-1。</p>
<p>插入排序的过程(剪辑版)如下图所示，你也可以<a href="/uploads/InsertSort1.gif">点击这里查看完整的插入排序过程</a>。<br><img src="/uploads/InsertSort.gif" alt="插入排序剪辑版"></p>
<h4 id="插入排序代码"><a href="#插入排序代码" class="headerlink" title="插入排序代码"></a>插入排序代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(Integer arr[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> compareCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> swapCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">long</span> before = System.currentTimeMillis();</span><br><span class="line">    <span class="comment">//外层循环，i表示有序子数组与无序子数组间的界限，i之前的元素为有序的，i及i之后的元素为无序的</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    	<span class="comment">//内层循环，将i到0之间的元素两两比较，若i&lt;i-1，则交换两者的位置</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">            compareCount++;</span><br><span class="line">            <span class="keyword">if</span> (arr[j] &lt; arr[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                swapCount++;</span><br><span class="line">                swap(arr, j, j - <span class="number">1</span>);<span class="comment">//两两交换</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> after = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"选择排序耗时："</span> + (after - before) + <span class="string">"ms,"</span> + <span class="string">"比较次数："</span> + compareCount + <span class="string">",交换次数："</span> + swapCount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们知道频繁的两两交换也是有性能损耗的，对于插入排序，我们通过如下的思路进一步优化：</p>
<ul>
<li>在新牌插入过程中，先在左手手牌的后方将新牌的空间给预留出来，从大到小，依次比较当前手牌与新牌。</li>
<li>若当前手牌大于新牌，则将当前手牌向后挪动一下（注意，此时并不拿新牌与当前手牌交换），将左手手牌后方的空间挤压到当前手牌的前方</li>
<li>若当前手牌小于新牌，则将新牌放到这里</li>
</ul>
<p>有了这个思路，我们便可以将此前频繁的两两交换，换为单个元素后移，从而减少了一定的性能开销。</p>
<h4 id="优化插入排序"><a href="#优化插入排序" class="headerlink" title="优化插入排序"></a>优化插入排序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertSortOpt</span><span class="params">(Integer arr[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> before = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    	<span class="comment">//使用临时变量保存新牌</span></span><br><span class="line">        <span class="keyword">int</span> temp  =arr[i];</span><br><span class="line">        <span class="keyword">int</span> j = i;</span><br><span class="line">        <span class="comment">//从大到小，依次取左手中的牌与temp进行比较，若左手当前手牌大于temp，则将当前手牌后移一位</span></span><br><span class="line">        <span class="keyword">while</span>(j&gt;<span class="number">0</span> &amp;&amp; temp&lt;arr[j-<span class="number">1</span>])&#123;</span><br><span class="line">        	arr[j] = arr[j -<span class="number">1</span>];</span><br><span class="line">        	j--;<span class="comment">//继续下一张较大的牌</span></span><br><span class="line">        &#125;</span><br><span class="line">        arr[j] = temp;<span class="comment">//最终将temp插入左手手牌中合适的位置</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> after = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"插入排序耗时："</span> + (after - before) + <span class="string">"ms"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在规模较大的问题中，这种方式带来的好处非常明显。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10W条数据</span><br><span class="line">   插入排序耗时：12296ms</span><br><span class="line">优化插入排序耗时：2742ms</span><br></pre></td></tr></table></figure>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><table>
<thead>
<tr>
<th>排序算法</th>
<th>问题规模（待排序元素个数）</th>
<th>解题时间1</th>
<th>解题时间2</th>
<th>解题时间3</th>
<th>平均解题时间</th>
</tr>
</thead>
<tbody><tr>
<td>优化冒泡排序</td>
<td>1W</td>
<td>293ms</td>
<td>293ms</td>
<td>278ms</td>
<td>288ms</td>
</tr>
<tr>
<td>选择排序</td>
<td>1W</td>
<td>28ms</td>
<td>43ms</td>
<td>52ms</td>
<td>41ms</td>
</tr>
<tr>
<td>优化插入排序</td>
<td>1W</td>
<td>22ms</td>
<td>36ms</td>
<td>28ms</td>
<td>28.7ms</td>
</tr>
<tr>
<td>优化冒泡排序</td>
<td>5W</td>
<td>7806ms</td>
<td>7428ms</td>
<td>8011ms</td>
<td>7748.3ms</td>
</tr>
<tr>
<td>选择排序</td>
<td>5W</td>
<td>603ms</td>
<td>617ms</td>
<td>606ms</td>
<td>608.7ms</td>
</tr>
<tr>
<td>优化插入排序</td>
<td>5W</td>
<td>598ms</td>
<td>606ms</td>
<td>600ms</td>
<td>601.3ms</td>
</tr>
<tr>
<td>优化冒泡排序</td>
<td>10W</td>
<td>28801ms</td>
<td>30978ms</td>
<td>29308ms</td>
<td>29725.7ms</td>
</tr>
<tr>
<td>选择排序</td>
<td>10W</td>
<td>2609ms</td>
<td>2649ms</td>
<td>2658ms</td>
<td>2638.7ms</td>
</tr>
<tr>
<td>优化插入排序</td>
<td>10W</td>
<td>2693ms</td>
<td>2712ms</td>
<td>2685ms</td>
<td>2696.7ms</td>
</tr>
</tbody></table>
<p>经过测试，可以看到冒泡排序的耗时最多。插入排序在规模较小的数组中明显快于选择排序，在规模较大的数组中与选择排序相当，从此也证明了我们此前算法分析环节中得到的结论。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>本文介绍了三个基础的排序算法，在这里先对它们做一个总结，希望能让大家对排序及算法效率有一个直观的感受。</p>
<table>
<thead>
<tr>
<th>排序算法</th>
<th>核心思路</th>
<th>最好情况(有序)</th>
<th>最坏情况(逆序)</th>
<th>时间复杂度O</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>优化冒泡排序</td>
<td>相邻元素两两比较并交换</td>
<td>比较n-1次，交换0次</td>
<td>比较n(n-1)/2次，交换n(n-1)/2次</td>
<td>O(n²)</td>
<td>简单易懂，效率较低</td>
</tr>
<tr>
<td>直接选择排序</td>
<td>已知位次找第k(大/小)元素</td>
<td>比较n(n-1)/2次，交换0次</td>
<td>比较n(n-1)/2次，交换n次</td>
<td>O(n²)</td>
<td>运行时间与原始数据无关；交换次数最少</td>
</tr>
<tr>
<td>优化插入排序</td>
<td>扑克牌起牌法</td>
<td>比较n-1次，交换0次</td>
<td>比较n(n-1)/2次，后移(n-1)(n-2)/2次</td>
<td>O(n²)</td>
<td>运行时间与原始数据强相关；对<strong>部分有序数据</strong>或<strong>小规模数据</strong>极为友好</td>
</tr>
</tbody></table>
<p>选择排序和插入排序的异同点：</p>
<ol>
<li>插入排序与选择排序一样，当前索引左边的所有元素都是有序的。但在选择排序中，当前索引左边的元素位置是固定的(与最终位置一致)；而插入排序当前索引左边的元素位置未必固定，为了给后边更小的元素腾出空间，它们可能会被移动，当索引到达数组的右端时，排序完成。</li>
<li>选择排序的运行时间与原始数据无关（比较次数恒定）；插入排序的运行时间与原始数据强相关，当对一个有序或接近有序的数组排序时，会比随机顺序或逆序的数组快很多。</li>
</ol>
<h4 id="参考书目"><a href="#参考书目" class="headerlink" title="参考书目"></a>参考书目</h4><blockquote>
<p>《算法导论》          - CLRS<br>《算法》第四版        - Sedgewick<br>《数据结构与算法分析》 - Weiss</p>
</blockquote>
<h4 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h4><p><a href="https://blog.csdn.net/hearwindcrying/article/details/80147219" target="_blank" rel="noopener">关于插入排序和选择排序的比较</a><br><a href="https://www.cnblogs.com/bjh1117/p/8335628.html" target="_blank" rel="noopener">Java排序算法分析与实现</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2018/06/22/coding-marathon-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/22/coding-marathon-02/" class="post-title-link" itemprop="url">编程马拉松 Day02 递归</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-21 21:47:05" itemprop="dateCreated datePublished" datetime="2018-06-21T21:47:05Z">2018-06-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E9%A9%AC%E6%8B%89%E6%9D%BE/" itemprop="url" rel="index"><span itemprop="name">编程马拉松</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/06/22/coding-marathon-02/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/22/coding-marathon-02/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天是第二天，继续我们的征程。</p>
<h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><ol>
<li>编写代码，把字符串中的每个空格替换为<code>%20</code>。例如，输入”hello world.”，则输出”hello%20world.”。</li>
<li>编写代码，给定系数n，求1+2+3+…+n的总和，即<code>∑</code>运算符</li>
<li>编写代码，观察如下数列，给定系数n，求数列中的第n个数字(tips: 斐波那契数列)。<br><code>1 1 2 3 5 8 13 21 34 55 89 ...</code></li>
</ol>
<h3 id="字符替换"><a href="#字符替换" class="headerlink" title="字符替换"></a>字符替换</h3><p>本题是将空格等特殊字符变为转义字符的函数，常用于URL编码中，用来避免URL中可能存在的字符歧义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前字符是否为普通字符</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPlainChar</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) ||</span><br><span class="line">            (c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'z'</span>) ||</span><br><span class="line">            (c &gt;= <span class="string">'A'</span> &amp;&amp; c &lt;= <span class="string">'Z'</span>) ||</span><br><span class="line">            c == <span class="string">'!'</span> || c == <span class="string">'$'</span> || c == <span class="string">'-'</span> || c == <span class="string">'.'</span> || c == <span class="string">'+'</span> ||</span><br><span class="line">            c == <span class="string">'*'</span> || c == <span class="string">'\''</span> || c == <span class="string">'('</span> || c == <span class="string">')'</span> || c == <span class="string">','</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span>[] encodeMap(<span class="keyword">char</span> c) &#123;</span><br><span class="line">    <span class="comment">//构造特殊字符映射表</span></span><br><span class="line">    String[] map = <span class="keyword">new</span> String[<span class="number">256</span>];</span><br><span class="line">    map[<span class="string">' '</span>] = <span class="string">"%20"</span>;</span><br><span class="line">    map[<span class="string">'/'</span>] = <span class="string">"%2F"</span>;</span><br><span class="line">    map[<span class="string">'?'</span>] = <span class="string">"%3F"</span>;</span><br><span class="line">    map[<span class="string">'%'</span>] = <span class="string">"%25"</span>;</span><br><span class="line">    map[<span class="string">'#'</span>] = <span class="string">"%23"</span>;</span><br><span class="line">    map[<span class="string">'&amp;'</span>] = <span class="string">"%26"</span>;</span><br><span class="line">    map[<span class="string">'='</span>] = <span class="string">"%3D"</span>;</span><br><span class="line">    <span class="keyword">return</span> map[c].toCharArray();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span>[] urlEncode(<span class="keyword">char</span> source[]) &#123;</span><br><span class="line">    <span class="keyword">int</span> needLength = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; source.length; i++) &#123;</span><br><span class="line">        <span class="keyword">char</span> c = source[i];</span><br><span class="line">        <span class="keyword">if</span> (isPlainChar(c)) &#123;</span><br><span class="line">            needLength++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            needLength += encodeMap(c).length;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> result[] = <span class="keyword">new</span> <span class="keyword">char</span>[needLength];</span><br><span class="line">    <span class="keyword">int</span> resultIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; source.length; i++) &#123;</span><br><span class="line">        <span class="keyword">char</span> c = source[i];</span><br><span class="line">        <span class="keyword">if</span> (isPlainChar(c)) &#123;</span><br><span class="line">            result[resultIndex] = c;</span><br><span class="line">            resultIndex++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">char</span> encodeStr[] = encodeMap(c);</span><br><span class="line">            System.arraycopy(encodeStr, <span class="number">0</span>, result, resultIndex, encodeStr.length);</span><br><span class="line">            resultIndex += encodeStr.length;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//===========</span></span><br><span class="line"><span class="comment">//测试代码</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>[] source = <span class="string">"hello world."</span>.toCharArray();</span><br><span class="line">    System.out.println(urlEncode(source));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="累加和-∑"><a href="#累加和-∑" class="headerlink" title="累加和 ∑"></a>累加和 <code>∑</code></h3><h4 id="正向循环解题"><a href="#正向循环解题" class="headerlink" title="正向循环解题"></a>正向循环解题</h4><p>要求n个数字的和，则需求出 <code>f(1)+f(2)+...+f(n-1)+f(n)</code>。<br>本题中等差数列的公差为1，则<code>f(1) == 1</code> ,<code>f(2) == 2...</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">sigmaAdd</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        sum+=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="逆向递归求解"><a href="#逆向递归求解" class="headerlink" title="逆向递归求解"></a>逆向递归求解</h4><p>通过观察数列，不难看出数列的如下性质:<br><code>f(n) = f(n-1) + 1</code><br>我们可以将∑n的问题转化为  <code>f(n) + f(n-1) +...+ f(2) + f(1)</code>，则可以使用递归来求解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">sigmaAdd2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> n + sigmaAdd(--n);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>递归在算法中的应用非常广泛，许多看似复杂的多重循环问题，都可以通过递归加中止条件写出较为简洁的代码</p>
</blockquote>
<h3 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a>斐波那契数列</h3><h4 id="递归算法"><a href="#递归算法" class="headerlink" title="递归算法"></a>递归算法</h4><p>先来看斐波那契数列的性质：</p>
<ol>
<li>当n=0时，f(n) = 0</li>
<li>当0=1时，f(n) = 1</li>
<li>当n&gt;1时，f(n) = f(n-2) + f(n-1)</li>
</ol>
<p>根据其性质，很容易通过递归写出其代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fibonacci</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//===========</span></span><br><span class="line"><span class="comment">//测试代码</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">    System.out.println(fibonacci(<span class="number">20</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>递归的代码虽然简洁，但简洁不代表简单。以求得f(10)为例，需要先求得f(9)和f(8)。同样，想求得f(9)，需要先求得f(8)和f(7)…我们可以用树形结构来表示这种依赖关系，如下图所示。<br><img src="/uploads/85859892-65AF-47A8-A0DA-8C38AB8626F5.png" alt="基于递归求斐波那契数列的第10项的调用过程"><br>不难发现，树中有很多结点是重复的，而且重复的结点数会随着n的增大而急剧增加，这意味着计算量会随着n的增大而急剧增大。你可以试下用递归方式求斐波那契数列的第50项试试，感受一下这样的递归会有多慢。</p>
<h4 id="非递归算法"><a href="#非递归算法" class="headerlink" title="非递归算法"></a>非递归算法</h4><p>递归方法之所以慢，是因为重复计算太多，只需想办法避免重复计算，即可加快其速度。比如我们可以把之前计算过的结果保存下来，便于下次计算。</p>
<p>比如先根据f(0)和f(1)得到f(2)，再根据f(1)和f(2)得到f(3)，每次结果均保留，依次类推即可得到第n项的值，其时间复杂度为O(n)。实现代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">fibonacci2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fib[] = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">0</span>, <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">2</span>) <span class="keyword">return</span> fib[n];</span><br><span class="line">    <span class="keyword">long</span> fib1 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">long</span> fib2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        result = fib1 + fib2;</span><br><span class="line">        fib2 = fib1;</span><br><span class="line">        fib1 = result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>时间对比</p>
<table>
<thead>
<tr>
<th>基准</th>
<th>递归方式</th>
<th>非递归方式</th>
</tr>
</thead>
<tbody><tr>
<td>fib(20)耗时</td>
<td>0ms</td>
<td>0ms</td>
</tr>
<tr>
<td>fib(30)耗时</td>
<td>4ms</td>
<td>0ms</td>
</tr>
<tr>
<td>fib(40)耗时</td>
<td>383ms</td>
<td>0ms</td>
</tr>
<tr>
<td>fib(50)耗时</td>
<td>44269ms</td>
<td>0ms</td>
</tr>
</tbody></table>
<p>通过表格可以看到，在时间方面非递归方式有着显著的优势。除了时间的开销，递归过程中还会创建多个函数栈，每个函数栈都有自己的参数，返回值等信息，因此递归也会给栈的内存空间带来一定的压力。如<code>StackOverflow</code>调用栈溢出异常就是由于栈空间不足引起的。</p>
<p>从思路上来讲，递归采用的是自顶向下的方式，将一个个较大的问题分解为若干个较小的问题（如 f(10) = f(9) + f(8)），但小的问题可能会有多次重复计算。我们可以反其道而行之，采用自底向上的方式，先从小问题开始处理，记录小问题的结果，然后根据小问题的结果来解答较大的问题，以此类推，得到特定问题的解。</p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>通过今天的练习，我们分析了递归的一些优缺点。在编写代码时，要了解递归潜在的问题，在一些注重性能的场合，尽量采用循环来代替递归，从而提高程序的运行效率。<br>此外在面试中，编程题通常不会太直白的表现出来，面试官往往会将问题包装一下，以此来考察我们的分析与建模能力，如下边几个问题。</p>
<ol>
<li>上台阶问题，一共有n个台阶，每次可以上1阶或2阶，那么上到第n阶有几种方法。</li>
<li>小马过河问题，河中有n块石头，小马每次能跳过1块或2块石头，那么跳过n块石头有几种方法。</li>
<li>如下图所示，用左边的2*1的小矩形横着或者竖着去覆盖右边2*8的大矩形，在不发生重叠的情况下，总共有多少种方法？<br><img src="/uploads/WX20180622-010309@2x.png" alt="矩形覆盖问题"></li>
</ol>
<h4 id="扩展题答案"><a href="#扩展题答案" class="headerlink" title="扩展题答案"></a>扩展题答案</h4><p>前两个问题基本一致，我们先来分析问题。<br>假设有n个台阶，则第一步有两种方法</p>
<ul>
<li>若上1个台阶，则剩下n-1个台阶</li>
<li>若上2个台阶，则剩下n-2个台阶</li>
</ul>
<p>以此类推，不难得出 <code>f(n) = f(n-1)+ f(n-2)</code> 这个式子，是不是很熟悉呢？对的，前两个问题仍是斐波那契数列相关的应用题，有公式后不难得出其答案。</p>
<p>接下来看第三个问题。<br>我们先把2*8的覆盖方法记为f(8)。用第一个2*1的小矩形去覆盖大举证的最左边边时有两种选择：</p>
<ul>
<li>竖着放，则右边还剩2*7的区域，记为f(7)</li>
<li>横着放，则左下方也只能横着放一个2*1的小举证，右边还剩下 2*6的区域，记为f(6)</li>
</ul>
<p>因此f(8) = f(7) + f(6)，此时可以看出，这仍然是斐波那契数列。</p>
<blockquote>
<p>参考书目<br>《剑指offer》2.4.1</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2018/06/21/coding-marathon-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/21/coding-marathon-01/" class="post-title-link" itemprop="url">编程马拉松 Day01 面试题小记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-20 23:10:12" itemprop="dateCreated datePublished" datetime="2018-06-20T23:10:12Z">2018-06-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E9%A9%AC%E6%8B%89%E6%9D%BE/" itemprop="url" rel="index"><span itemprop="name">编程马拉松</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/06/21/coding-marathon-01/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/21/coding-marathon-01/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>打算从今天起开始每日一练，巩固一下算法，数据结构相关的知识，废话少说，开始看题。</p>
<p><img src="/uploads/3A3E4F00-5D42-4144-A5A5-BE08ECB86ACE.png" alt="题目"></p>
<p>以上是我近期面试中遇到的一些题，其中1，3题出自百度系面试官；2，4出自Uber系面试官。</p>
<h3 id="两个水杯倒出3L水的问题"><a href="#两个水杯倒出3L水的问题" class="headerlink" title="两个水杯倒出3L水的问题"></a>两个水杯倒出3L水的问题</h3><p>先来看第一个问题，题干是要求倒腾出3L的水。我们可以从4、5两个数字入手，观察通过怎样的方式能够得到3，得到以下两种情况</p>
<ul>
<li>4 * 2 -5 == 3</li>
<li>( 5 - 4 ) * 3 == 3 </li>
</ul>
<p>转换为文字</p>
<ol>
<li>第一种方式<ul>
<li>先将4L的杯子接满水，全部倒入到5L的杯子中（tips：此时4L的杯子为空，5L的杯子中装载了4L水，还能再倒入1L）</li>
<li>再将4L的杯子接满水，然后向5L的杯子倒水，当5L杯子倒满时，4L杯子剩下3L水</li>
</ul>
</li>
<li>第二种方式<ul>
<li>将5L的杯子接满水，倒入4L的杯子中（tips: 此时5L的杯子剩下1L水），然后将4L杯子的水全部倒掉，再将5L杯子剩余的1L水倒入4L的杯子（tips: 此时4L杯子有1L水）</li>
<li>将5L的杯子接满水，倒入4L的杯子中（tips: 由于上一轮4L杯子已存在1L水，本次5L杯最多只能倒出3L水，倒出后5L杯剩余2L水），然后将4L杯子的水全部的倒掉，再将5L杯子剩余的2L水倒入到4L的杯子（tips: 此时4L杯子有2L水）</li>
<li>将5L的杯子接满水，倒入4L的杯子中（tips: 由于上一轮4L杯子已存在2L水，本次5L杯最多只能倒出2L水，倒出后5L杯正好剩余3L水）</li>
</ul>
</li>
</ol>
<h3 id="大数四则运算"><a href="#大数四则运算" class="headerlink" title="大数四则运算"></a>大数四则运算</h3><p>第二个问题是一个典型的大数运算问题。编程中有时会遇到数字上溢（tips: 如数值的大小超过了Long型可表示的最大数）的问题，此时便需要采用字符串替换原有的数值计算。</p>
<p>以10进制加法为例，解决思路如下：</p>
<ol>
<li>使用字符串装载参与计算的两个数值</li>
<li>分别取两个字符串的末尾数值 a和b，进行相加计算 sum = a+b ，如结果sum大于9，则设置进位标志 flag = 1；否则设置 flag = 0。记录sum%10，表示当前位的结果</li>
<li>再次取两个字符串的次末尾数值 a和b，进行相加计算 sum = a+b+flag ，如结果sum大于9，则设置进位标志 flag = 1；否则设置 flag = 0。记录sum%10，表示当前位的结果<br>…</li>
<li>重复以上步骤，若两个数字字符串的长度不一致，则当其中较短字符串s1遍历完成后，只遍历另一个字符串s2，每次取出s2的末位数值与flag相加，得到新的进制标志和当前位的结果。</li>
</ol>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">bigSumAdd</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();<span class="comment">//字符串构造器</span></span><br><span class="line">        <span class="keyword">int</span> flag = <span class="number">0</span>;<span class="comment">//初始化进位标志</span></span><br><span class="line">        <span class="comment">//判定操作数长度大小</span></span><br><span class="line">        String longer = s1.length() &gt; s2.length() ? s1 : s2;</span><br><span class="line">        String shorter = s1.length() &gt; s2.length() ? s2 : s1;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= longer.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> last1 = longer.length() - i ;<span class="comment">//取longger最后一位的索引值</span></span><br><span class="line">            <span class="keyword">int</span> last2 = shorter.length() - i ;<span class="comment">//取shorter最后一位的索引值</span></span><br><span class="line">            <span class="keyword">int</span> currentLonger = (<span class="keyword">int</span>) longer.charAt(last1);</span><br><span class="line">            <span class="keyword">if</span> (i &lt; shorter.length()) &#123;</span><br><span class="line">                <span class="keyword">int</span> currentShorter = (<span class="keyword">int</span>) shorter.charAt(last2);</span><br><span class="line">                <span class="comment">//每次charAt()取出的只是char型变量 '1'~'9',需减去'0'方可得到数字1~9。</span></span><br><span class="line">                <span class="keyword">int</span> sum = (currentShorter - <span class="string">'0'</span>) + (currentLonger - <span class="string">'0'</span>) + flag;</span><br><span class="line">                flag = sum &gt; <span class="number">9</span> ? <span class="number">1</span> : <span class="number">0</span>;<span class="comment">//设置进位标志flag</span></span><br><span class="line">                stringBuilder.append(sum % <span class="number">10</span>);<span class="comment">//将当前位结果append到stringBuilder中</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> sum = currentLonger - <span class="string">'0'</span> + flag;</span><br><span class="line">                flag = sum &gt; <span class="number">9</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">                stringBuilder.append(sum % <span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//反转字符串，输出</span></span><br><span class="line">        <span class="keyword">return</span> stringBuilder.reverse().toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字符串去重"><a href="#字符串去重" class="headerlink" title="字符串去重"></a>字符串去重</h3><p>这道题比较简单，有多种方法。</p>
<h4 id="先排序再去重，时间复杂度-O-N-LogN"><a href="#先排序再去重，时间复杂度-O-N-LogN" class="headerlink" title="先排序再去重，时间复杂度 O(N*LogN)"></a>先排序再去重，时间复杂度 <code>O(N*LogN)</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">deDuplicate</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> strArr[] = str.toCharArray();<span class="comment">//将字符串能转化为字符数组</span></span><br><span class="line">    Arrays.sort(strArr);<span class="comment">//将字符数组排序</span></span><br><span class="line">    <span class="keyword">char</span> pre = strArr[<span class="number">0</span>];<span class="comment">//取字符数组首位字符</span></span><br><span class="line">    StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    stringBuffer.append(pre);<span class="comment">//添加到缓冲中</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; strArr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">char</span> current = strArr[i];</span><br><span class="line">        <span class="keyword">if</span> (current == pre) &#123;<span class="comment">//判断当前字符与之前字符是否一致，若一致则跳过此次循环</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        stringBuffer.append(current);<span class="comment">//否则将当前字符添加到缓冲中</span></span><br><span class="line">        pre = current;<span class="comment">//将当前字符赋值于pre</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//输出</span></span><br><span class="line">    <span class="keyword">return</span> stringBuffer.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="采用辅助空间，时间复杂度-O-N-，空间复杂度与字符串编码集相关"><a href="#采用辅助空间，时间复杂度-O-N-，空间复杂度与字符串编码集相关" class="headerlink" title="采用辅助空间，时间复杂度 O(N)，空间复杂度与字符串编码集相关"></a>采用辅助空间，时间复杂度 <code>O(N)</code>，空间复杂度与字符串编码集相关</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">deDuplicate2</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> help[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">65536</span>];<span class="comment">//65536即2^16,可对应2个字节以内的任意字符</span></span><br><span class="line">    StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">char</span> current = str.charAt(i);<span class="comment">//去当前字符</span></span><br><span class="line">        <span class="keyword">if</span> (help[current] != <span class="number">0</span>) &#123;<span class="comment">//若当前字符已存在，则跳过本次循环</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            help[current]++;<span class="comment">//否则将当前字符对应的位置位非0</span></span><br><span class="line">            stringBuffer.append(current);<span class="comment">//添加到缓冲中</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//输出</span></span><br><span class="line">    <span class="keyword">return</span> stringBuffer.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="杨辉三角"><a href="#杨辉三角" class="headerlink" title="杨辉三角"></a>杨辉三角</h3><p>这道题是一个三角问题，观察三角构型，得到如下现象：</p>
<ol>
<li>从第一行到第五行，每行依次有1，2，3，4，5个数字…</li>
<li>n行的三角共有 1+2+..+n-1+n 个数字</li>
<li>每一行的首位及末位数字均为’1’，中间数字为正上方左右两个数字的和。</li>
</ol>
<p> 若用一维数组存储三角中的所有数字，从上到下，从左到右开始索引，则从第i行，索引值为index的数值 arr[index] =  arr[index - i] + arr[index-i-1]，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印杨辉三角</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n 表示杨辉三角的行数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">yanhuiTriangle</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//得到一维数组长度</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        size += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> arr[] = <span class="keyword">new</span> <span class="keyword">int</span>[size];<span class="comment">//创建一维数组</span></span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;<span class="comment">//外层循环，控制行</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n - i; j++) &#123;</span><br><span class="line">            System.out.print(<span class="string">" "</span>);<span class="comment">//打印数字之前的空格</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= i; j++) &#123;<span class="comment">//内存循环，控制列</span></span><br><span class="line">            <span class="keyword">if</span> (j == <span class="number">0</span> || j == i) &#123;<span class="comment">//每行的首位及末尾</span></span><br><span class="line">                arr[index] = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                arr[index] = arr[index - i] + arr[index - i - <span class="number">1</span>];<span class="comment">//中间位求值</span></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print(arr[index] + <span class="string">" "</span>);<span class="comment">//打印数值</span></span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>第一天的开胃菜到此结束，题目本身并不难，更多的是对编程思维的考察，今天先到这里，如有疑问欢迎与我联系 ：）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2018/06/07/IntelliJ%20IDEA%20%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95%E6%97%B6%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E5%8F%98%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/07/IntelliJ%20IDEA%20%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95%E6%97%B6%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E5%8F%98%E9%87%8F/" class="post-title-link" itemprop="url">IntelliJ IDEA 断点调试时查看所有变量</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-07 14:34:17" itemprop="dateCreated datePublished" datetime="2018-06-07T14:34:17Z">2018-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">develop</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/06/07/IntelliJ%20IDEA%20%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95%E6%97%B6%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E5%8F%98%E9%87%8F/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/07/IntelliJ IDEA 断点调试时查看所有变量/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>849</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在看<a href="http://yikun.github.io/2015/04/01/Java-HashMap%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/" target="_blank" rel="noopener">Java HashMap工作原理及实现</a>这篇文章时，发现博主在断点模式下来观察hash冲突的效果挺好的，随后便想在IntelliJ IDEA中也试下。</p>
<p>我们先来看下HashMap.Node的代码，有4个成员变量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        V value;</span><br><span class="line">        Node&lt;K,V&gt; next;</span><br><span class="line">        <span class="comment">//省略后续内容</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如下图所示，对于HashMap.Node类型的对象，IDEA默认只显示了key，value这两个成员变量。</p>
<p><img src="/uploads/20180607152835781571470.png" alt=""></p>
<p>原因在于IDEA默认将HashMap.Node视为了Map.Entry，那么如何在Debug时以HashMap.Node的类型来查看该对象其他变量呢？</p>
<p>方法有二：</p>
<p>一. 在debugger的Variables面板中，右键该对象，找到View As选项，选择其中的Object，然后就可以看到该对象的所有属性了。</p>
<p><img src="/uploads/20180607152835873635379.png" alt=""></p>
<p>二. 采用第一种方式时，每次Debug都需要手动指定其类型，较为繁琐。对于常用的类，我们也可以在View as时点击Create按钮，为其新建类型。这样的话以后每次Debug时，无需任何设置就能在Variables面板内直接看到其准确类型的所有属性。</p>
<p>Create过程也很简单，在Java Type Renders窗口内，设置HashMap$Node对应的完整类名即可，如下图所示。<br><img src="/uploads/20180607152835921758924.png" alt=""></p>
<p>最后看一下，在View as中Create了HashMap及HashMap.Node后的效果。<br><img src="/uploads/2018060715283595974118.png" alt=""></p>
<p>现在已经能看到类中的所有成员变量了，那么对于静态变量该如何查看呢？这个也很简单，同样在此处右键，点击Customize Data Views…<br><img src="/uploads/20180607152835995681268.png" alt=""></p>
<p>然后在Static fields和Static final fields的选项前打勾即可~</p>
<p><img src="/uploads/20180607152836010286020.png" alt=""></p>
<p>以HashMap为例，在选中了Static fields和Static final fields的选项后，所有的静态变量也显示出来了 ：）<br><img src="/uploads/20180607152836024325067.png" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2014/08/19/objcruntime-explore4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/08/19/objcruntime-explore4/" class="post-title-link" itemprop="url">objc/runtime 探索(四)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2014-08-19 00:00:00" itemprop="dateCreated datePublished" datetime="2014-08-19T00:00:00Z">2014-08-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">develop</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2014/08/19/objcruntime-explore4/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2014/08/19/objcruntime-explore4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在这一篇中,我们来聊一聊runtime中<code>method</code></p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>先来看一下<code>method</code>相关的定义</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> *<span class="title">Method</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_selector</span> *<span class="title">SEL</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*IMP)</span><span class="params">(<span class="keyword">void</span> <span class="comment">/* id, SEL, ... */</span> )</span></span>; </span><br><span class="line"><span class="comment">//方法描述</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method_description</span> &#123;</span></span><br><span class="line">trueSEL name;               <span class="comment">//方法名称</span></span><br><span class="line">true<span class="keyword">char</span> *types;            <span class="comment">//参数类型字符串</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//以下代码是 ObjC2.0 之前method的定义</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> &#123;</span></span><br><span class="line">    SEL method_name;</span><br><span class="line">    <span class="keyword">char</span> *method_types;</span><br><span class="line">    IMP method_imp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>里边有三个类型别名,在这儿先解释一下</p>
<ul>
<li><code>SEL</code>   selector的简写,俗称方法选择器,实质存储的是方法的名称  </li>
<li><code>IMP</code>   implement的简写,俗称方法实现,看源码得知它就是一个函数指针  </li>
<li><code>Method</code> 对上述两者的一个包装结构.  </li>
</ul>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>method相关的函数也不是太多,下边简单罗列说明一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断类中是否包含某个方法的实现</span></span><br><span class="line"><span class="function">BOOL <span class="title">class_respondsToSelector</span><span class="params">(Class cls, SEL sel)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取类中的方法列表</span></span></span><br><span class="line"><span class="function">Method *<span class="title">class_copyMethodList</span><span class="params">(Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount)</span> </span></span><br><span class="line"><span class="function"><span class="comment">//为类添加新的方法,如果方法该方法已存在则返回NO</span></span></span><br><span class="line"><span class="function">BOOL <span class="title">class_addMethod</span><span class="params">(Class cls, SEL name, IMP imp, <span class="keyword">const</span> <span class="keyword">char</span> *types)</span></span></span><br><span class="line"><span class="function"><span class="comment">//替换类中已有方法的实现,如果该方法不存在添加该方法</span></span></span><br><span class="line"><span class="function">IMP <span class="title">class_replaceMethod</span><span class="params">(Class cls, SEL name, IMP imp, <span class="keyword">const</span> <span class="keyword">char</span> *types)</span> </span></span><br><span class="line"><span class="function"><span class="comment">//获取类中的某个实例方法(减号方法)</span></span></span><br><span class="line"><span class="function">Method <span class="title">class_getInstanceMethod</span><span class="params">(Class cls, SEL name)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取类中的某个类方法(加号方法)</span></span></span><br><span class="line"><span class="function">Method <span class="title">class_getClassMethod</span><span class="params">(Class cls, SEL name)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取类中的方法实现</span></span></span><br><span class="line"><span class="function">IMP <span class="title">class_getMethodImplementation</span><span class="params">(Class cls, SEL name)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取类中的方法的实现,该方法的返回值类型为struct</span></span></span><br><span class="line"><span class="function">IMP <span class="title">class_getMethodImplementation_stret</span><span class="params">(Class cls, SEL name)</span> </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//获取Method中的SEL</span></span></span><br><span class="line"><span class="function">SEL <span class="title">method_getName</span><span class="params">(Method m)</span> </span></span><br><span class="line"><span class="function"><span class="comment">//获取Method中的IMP</span></span></span><br><span class="line"><span class="function">IMP <span class="title">method_getImplementation</span><span class="params">(Method m)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取方法的Type字符串(包含参数类型和返回值类型)</span></span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">method_getTypeEncoding</span><span class="params">(Method m)</span> </span></span><br><span class="line"><span class="function"><span class="comment">//获取参数个数</span></span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">method_getNumberOfArguments</span><span class="params">(Method m)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取返回值类型字符串</span></span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">method_copyReturnType</span><span class="params">(Method m)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取方法中第n个参数的Type</span></span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">method_copyArgumentType</span><span class="params">(Method m, <span class="keyword">unsigned</span> <span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取Method的描述</span></span></span><br><span class="line"><span class="function">struct objc_method_description *<span class="title">method_getDescription</span><span class="params">(Method m)</span></span></span><br><span class="line"><span class="function"><span class="comment">//设置Method的IMP</span></span></span><br><span class="line"><span class="function">IMP <span class="title">method_setImplementation</span><span class="params">(Method m, IMP imp)</span> </span></span><br><span class="line"><span class="function"><span class="comment">//替换Method</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">method_exchangeImplementations</span><span class="params">(Method m1, Method m2)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//获取SEL的名称</span></span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">sel_getName</span><span class="params">(SEL sel)</span></span></span><br><span class="line"><span class="function"><span class="comment">//注册一个SEL</span></span></span><br><span class="line"><span class="function">SEL <span class="title">sel_registerName</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *str)</span></span></span><br><span class="line"><span class="function"><span class="comment">//判断两个SEL对象是否相同</span></span></span><br><span class="line"><span class="function">BOOL <span class="title">sel_isEqual</span><span class="params">(SEL lhs, SEL rhs)</span> </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//通过块创建函数指针,block的形式为^ReturnType(id self,参数,...)</span></span></span><br><span class="line"><span class="function">IMP <span class="title">imp_implementationWithBlock</span><span class="params">(id block)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取IMP中的block</span></span></span><br><span class="line"><span class="function">id <span class="title">imp_getBlock</span><span class="params">(IMP anImp)</span></span></span><br><span class="line"><span class="function"><span class="comment">//移出IMP中的block</span></span></span><br><span class="line"><span class="function">BOOL <span class="title">imp_removeBlock</span><span class="params">(IMP anImp)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//调用target对象的sel方法</span></span></span><br><span class="line"><span class="function">id <span class="title">objc_msgSend</span><span class="params">(id target, SEL sel, 参数列表...)</span></span></span><br></pre></td></tr></table></figure>

<h3 id="Showtime"><a href="#Showtime" class="headerlink" title="Showtime"></a>Showtime</h3><p>下边就来玩玩runtime API中的method相关操作</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建继承自NSObject类的People类</span></span><br><span class="line">Class People = objc_allocateClassPair([<span class="built_in">NSObject</span> <span class="keyword">class</span>], <span class="string">"People"</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//将People类注册到runtime中</span></span><br><span class="line">objc_registerClassPair(People);</span><br><span class="line"><span class="comment">//注册test: 方法选择器</span></span><br><span class="line">SEL sel = sel_registerName(<span class="string">"test:"</span>);</span><br><span class="line"><span class="comment">//函数实现</span></span><br><span class="line">IMP imp = imp_implementationWithBlock(^(<span class="keyword">id</span> <span class="keyword">this</span>,<span class="keyword">id</span> args,...)&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"方法的调用者为 %@"</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"参数为 %@"</span>,args);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">@"返回值测试"</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//向People类中添加 test:方法;函数签名为@@://    第一个@表示返回值类型为i//    第二个@表示的是函数的调用者类//    第三个:表示 S//    第四个@表示需要一个id类型的参数</span></span><br><span class="line">class_addMethod(People, sel, imp, <span class="string">"@@:@"</span>);</span><br><span class="line"><span class="comment">//替换People从NSObject类中继承而来的description方法</span></span><br><span class="line">class_replaceMethod(People,</span><br><span class="line">                    <span class="keyword">@selector</span>(description),</span><br><span class="line">                    imp_implementationWithBlock(^<span class="built_in">NSString</span>*(<span class="keyword">id</span> <span class="keyword">this</span>,...)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">@"我是Person类的对象"</span>;&#125;),</span><br><span class="line">                    <span class="string">"@@:"</span>);</span><br><span class="line"><span class="comment">//完成 [[People alloc]init];</span></span><br><span class="line"><span class="keyword">id</span> p1 = objc_msgSend(objc_msgSend(People, <span class="keyword">@selector</span>(alloc)),<span class="keyword">@selector</span>(init));</span><br><span class="line"><span class="comment">//调用p1的sel选择器的方法,并传递@"???"作为参数</span></span><br><span class="line"><span class="keyword">id</span> result = objc_msgSend(p1, sel,<span class="string">@"???"</span>);</span><br><span class="line"><span class="comment">//输出sel方法的返回值</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"sel 方法的返回值为 ： %@"</span>,result);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取People类中实现的方法列表</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"输出People类中实现的方法列表"</span>);</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> methodCount;</span><br><span class="line">Method * methods = class_copyMethodList(People, &amp;methodCount);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;methodCount; i++) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"方法名称:%s"</span>,sel_getName(method_getName(methods[i])));</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"方法Types:%s"</span>,method_getDescription(methods[i])-&gt;types);</span><br><span class="line">&#125;</span><br><span class="line">free(methods);</span><br></pre></td></tr></table></figure>
<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-20</span> <span class="number">00</span>:<span class="number">03</span>:<span class="number">38.496</span> Test[<span class="number">99505</span>:<span class="number">303</span>] 方法的调用者为 我是Person类的对象</span><br><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-20</span> <span class="number">00</span>:<span class="number">03</span>:<span class="number">38.498</span> Test[<span class="number">99505</span>:<span class="number">303</span>] 参数为 ???</span><br><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-20</span> <span class="number">00</span>:<span class="number">03</span>:<span class="number">38.498</span> Test[<span class="number">99505</span>:<span class="number">303</span>] sel 方法的返回值为 ： 返回值测试</span><br><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-20</span> <span class="number">00</span>:<span class="number">03</span>:<span class="number">38.499</span> Test[<span class="number">99505</span>:<span class="number">303</span>] 输出People类中实现的方法列表</span><br><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-20</span> <span class="number">00</span>:<span class="number">03</span>:<span class="number">38.499</span> Test[<span class="number">99505</span>:<span class="number">303</span>] 方法名称:description</span><br><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-20</span> <span class="number">00</span>:<span class="number">03</span>:<span class="number">38.499</span> Test[<span class="number">99505</span>:<span class="number">303</span>] 方法Types:@@:</span><br><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-20</span> <span class="number">00</span>:<span class="number">03</span>:<span class="number">38.500</span> Test[<span class="number">99505</span>:<span class="number">303</span>] 方法名称:test:</span><br><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-20</span> <span class="number">00</span>:<span class="number">03</span>:<span class="number">38.500</span> Test[<span class="number">99505</span>:<span class="number">303</span>] 方法Types:@@:@</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2014/08/18/objcruntime-explore3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/08/18/objcruntime-explore3/" class="post-title-link" itemprop="url">objc/runtime 探索(三)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2014-08-18 00:00:00" itemprop="dateCreated datePublished" datetime="2014-08-18T00:00:00Z">2014-08-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">develop</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2014/08/18/objcruntime-explore3/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2014/08/18/objcruntime-explore3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>续前,本文主要谈论类中的变量和属性</p>
<h3 id="1-Ivar"><a href="#1-Ivar" class="headerlink" title="1.Ivar"></a>1.Ivar</h3><h4 id="1-1-Ivar的类型"><a href="#1-1-Ivar的类型" class="headerlink" title="1.1 Ivar的类型"></a>1.1 Ivar的类型</h4><p><code>typedef objc_ivar * Ivar;</code>  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_ivar</span> &#123;</span></span><br><span class="line">true<span class="keyword">char</span> *ivar_name;      	<span class="comment">//ivar名称                          </span></span><br><span class="line">true<span class="keyword">char</span> *ivar_type;        <span class="comment">//ivar类型</span></span><br><span class="line">true<span class="keyword">int</span> ivar_offset;		<span class="comment">//ivar偏移量</span></span><br><span class="line">true<span class="meta">#<span class="meta-keyword">ifdef</span> __LP64__</span></span><br><span class="line">    	<span class="keyword">int</span> space;</span><br><span class="line">true<span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;<span class="comment">//ObjC2.0 已过时</span></span><br></pre></td></tr></table></figure>

<p><code>Ivar</code>是<code>objc_ivar</code>的指针,包含变量名称,变量类型等成员.</p>
<h4 id="1-2-为类添加Ivar"><a href="#1-2-为类添加Ivar" class="headerlink" title="1.2 为类添加Ivar"></a>1.2 为类添加Ivar</h4><p>运行时规定,只能在<code>objc_allocateClassPair</code>与<code>objc_registerClassPair</code>两个函数之间为类添加变量</p>
<p>如下所示:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//额外空间     未知,通常设置为 0</span></span><br><span class="line">Class clazz = objc_allocateClassPair(父类class,类名,额外空间);</span><br><span class="line"><span class="comment">//以NSString*为例</span></span><br><span class="line"><span class="comment">//变量size sizeof(NSString)</span></span><br><span class="line"><span class="comment">//对齐     指针类型的为log2(sizeof(NSString*))</span></span><br><span class="line"><span class="comment">//类型     @encode(NSString*)</span></span><br><span class="line">BOOL flag = class_addIvar(clazz,变量名,变量<span class="built_in">size</span>,对齐,类型);</span><br><span class="line">objc_registerClassPair(clazz);</span><br></pre></td></tr></table></figure>
<h4 id="1-3-Ivar的相关操作"><a href="#1-3-Ivar的相关操作" class="headerlink" title="1.3 Ivar的相关操作"></a>1.3 Ivar的相关操作</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取Ivar的名称</span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">ivar_getName</span><span class="params">(Ivar v)</span></span>;</span><br><span class="line"><span class="comment">//获取Ivar的类型编码,</span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">ivar_getTypeEncoding</span><span class="params">(Ivar v)</span></span></span><br><span class="line"><span class="function"><span class="comment">//通过变量名称获取类中的实例成员变量</span></span></span><br><span class="line"><span class="function">Ivar <span class="title">class_getInstanceVariable</span><span class="params">(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span></span><br><span class="line"><span class="function"><span class="comment">//通过变量名称获取类中的类成员变量</span></span></span><br><span class="line"><span class="function">Ivar <span class="title">class_getClassVariable</span><span class="params">(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取指定类的Ivar列表及Ivar个数</span></span></span><br><span class="line"><span class="function">Ivar *<span class="title">class_copyIvarList</span><span class="params">(Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取实例对象中Ivar的值</span></span></span><br><span class="line"><span class="function">id <span class="title">object_getIvar</span><span class="params">(id obj, Ivar ivar)</span> </span></span><br><span class="line"><span class="function"><span class="comment">//设置实例对象中Ivar的值</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">object_setIvar</span><span class="params">(id obj, Ivar ivar, id value)</span></span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-Ivar的使用"><a href="#1-4-Ivar的使用" class="headerlink" title="1.4 Ivar的使用"></a>1.4 Ivar的使用</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在运行时创建继承自NSObject的People类</span></span><br><span class="line">   Class People = objc_allocateClassPair([NSObject class], <span class="string">"People"</span>, <span class="number">0</span>);</span><br><span class="line">   <span class="comment">//添加_name成员变量</span></span><br><span class="line">   BOOL flag1 = class_addIvar(People, <span class="string">"_name"</span>, <span class="keyword">sizeof</span>(NSString*), log2(<span class="keyword">sizeof</span>(NSString*)), @encode(NSString*));</span><br><span class="line">   <span class="keyword">if</span> (flag1) &#123;</span><br><span class="line">       NSLog(@<span class="string">"NSString*类型  _name变量添加成功"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//添加_age成员变量</span></span><br><span class="line">   BOOL flag2 = class_addIvar(People, <span class="string">"_age"</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="keyword">sizeof</span>(<span class="keyword">int</span>), @encode(<span class="keyword">int</span>));</span><br><span class="line">   <span class="keyword">if</span> (flag2) &#123;</span><br><span class="line">       NSLog(@<span class="string">"int类型 _age变量添加成功"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//完成People类的创建</span></span><br><span class="line">   objc_registerClassPair(People);</span><br><span class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> varCount;</span><br><span class="line">   <span class="comment">//拷贝People类中的成员变量列表</span></span><br><span class="line">   Ivar * varList = class_copyIvarList(People, &amp;varCount);</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;varCount; i++) &#123;</span><br><span class="line">       NSLog(@<span class="string">"%s"</span>,ivar_getName(varList[i]));</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//释放varList</span></span><br><span class="line">   <span class="built_in">free</span>(varList);</span><br><span class="line">   <span class="comment">//创建People对象p1</span></span><br><span class="line">   id p1 = [[People alloc]init];</span><br><span class="line">   <span class="comment">//从类中获取成员变量Ivar</span></span><br><span class="line">   Ivar nameIvar = class_getInstanceVariable(People, <span class="string">"_name"</span>);</span><br><span class="line">   Ivar ageIvar = class_getInstanceVariable(People, <span class="string">"_age"</span>);</span><br><span class="line">   <span class="comment">//为p1的成员变量赋值</span></span><br><span class="line">   object_setIvar(p1, nameIvar, @<span class="string">"张三"</span>);</span><br><span class="line">   object_setIvar(p1, ageIvar, @<span class="number">33</span>);</span><br><span class="line">   <span class="comment">//获取p1成员变量的值</span></span><br><span class="line">   NSLog(@<span class="string">"%@"</span>,object_getIvar(p1, nameIvar));</span><br><span class="line">   NSLog(@<span class="string">"%@"</span>,object_getIvar(p1, ageIvar));</span><br></pre></td></tr></table></figure>
<h3 id="2-Property"><a href="#2-Property" class="headerlink" title="2.Property"></a>2.Property</h3><h3 id="2-1-objc-property-t-与-objc-property-attribute-t类型"><a href="#2-1-objc-property-t-与-objc-property-attribute-t类型" class="headerlink" title="2.1 objc_property_t 与 objc_property_attribute_t类型"></a>2.1 objc_property_t 与 objc_property_attribute_t类型</h3><p><code>typedef struct objc_property *objc_property_t;</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//特性</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">char</span> *name;           <span class="comment">//特性名称</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">char</span> *value;          <span class="comment">//特性的值</span></span><br><span class="line">&#125; <span class="keyword">objc_property_attribute_t</span>;</span><br></pre></td></tr></table></figure>
<p><strong>特性相关编码</strong></p>
<p>属性的特性字符串 以 T@encode(type) 开头, 以 V实例变量名称 结尾,中间以特性编码填充,通过<code>property_getAttributes</code>即可查看</p>
<table>
<thead>
<tr>
<th>特性编码</th>
<th>具体含义</th>
</tr>
</thead>
<tbody><tr>
<td>R</td>
<td>readonly</td>
</tr>
<tr>
<td>C</td>
<td>copy</td>
</tr>
<tr>
<td>&amp;</td>
<td>retain</td>
</tr>
<tr>
<td>N</td>
<td>nonatomic</td>
</tr>
<tr>
<td>G(name)</td>
<td>getter=(name)</td>
</tr>
<tr>
<td>S(name)</td>
<td>setter=(name)</td>
</tr>
<tr>
<td>D</td>
<td>@dynamic</td>
</tr>
<tr>
<td>W</td>
<td>weak</td>
</tr>
<tr>
<td>P</td>
<td>用于垃圾回收机制</td>
</tr>
</tbody></table>
<h3 id="2-2-为类添加Property"><a href="#2-2-为类添加Property" class="headerlink" title="2.2 为类添加Property"></a>2.2 为类添加Property</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">class_addProperty</span><span class="params">(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> <span class="keyword">objc_property_attribute_t</span> *attributes, <span class="keyword">unsigned</span> <span class="keyword">int</span> attributeCount)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-Property的相关操作"><a href="#2-3-Property的相关操作" class="headerlink" title="2.3 Property的相关操作"></a>2.3 Property的相关操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//替换类中的属性</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">class_replaceProperty</span><span class="params">(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> <span class="keyword">objc_property_attribute_t</span> *attributes, <span class="keyword">unsigned</span> <span class="keyword">int</span> attributeCount)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取类中的属性</span></span></span><br><span class="line"><span class="function"><span class="keyword">objc_property_t</span> <span class="title">class_getProperty</span><span class="params">(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span></span><br><span class="line"><span class="function"><span class="comment">//拷贝类中的属性列表</span></span></span><br><span class="line"><span class="function"><span class="keyword">objc_property_t</span> *<span class="title">class_copyPropertyList</span><span class="params">(Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取属性名称</span></span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">property_getName</span><span class="params">(<span class="keyword">objc_property_t</span> property)</span></span></span><br><span class="line"><span class="function"><span class="comment">//获取属性的特性</span></span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">property_getAttributes</span><span class="params">(<span class="keyword">objc_property_t</span> property)</span> </span></span><br><span class="line"><span class="function"><span class="comment">//拷贝属性的特性列表</span></span></span><br><span class="line"><span class="function"><span class="keyword">objc_property_attribute_t</span> *<span class="title">property_copyAttributeList</span><span class="params">(<span class="keyword">objc_property_t</span> property, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount)</span></span></span><br><span class="line"><span class="function"><span class="comment">//拷贝属性的特性的值</span></span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">property_copyAttributeValue</span><span class="params">(<span class="keyword">objc_property_t</span> property, <span class="keyword">const</span> <span class="keyword">char</span> *attributeName)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-Property的使用"><a href="#2-4-Property的使用" class="headerlink" title="2.4 Property的使用"></a>2.4 Property的使用</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Class People = objc_allocateClassPair([<span class="built_in">NSObject</span> <span class="keyword">class</span>], <span class="string">"People"</span>, <span class="number">0</span>);</span><br><span class="line">   objc_registerClassPair(People);</span><br><span class="line">   <span class="comment">//T@</span></span><br><span class="line">   objc_property_attribute_t attribute1;</span><br><span class="line">   attribute1.name = <span class="string">"T"</span>;</span><br><span class="line">   attribute1.value=<span class="keyword">@encode</span>(<span class="built_in">NSString</span>*);</span><br><span class="line">   <span class="comment">//Noatomic</span></span><br><span class="line">   objc_property_attribute_t attribute2 = &#123;<span class="string">"N"</span>,<span class="string">""</span>&#125;;<span class="comment">//value无意义时通常设置为空</span></span><br><span class="line">   <span class="comment">//Copy</span></span><br><span class="line">   objc_property_attribute_t attribute3 = &#123;<span class="string">"C"</span>,<span class="string">""</span>&#125;;</span><br><span class="line">   <span class="comment">//V_属性名</span></span><br><span class="line">   objc_property_attribute_t attribute4 = &#123;<span class="string">"V"</span>,<span class="string">"_name"</span>&#125;;</span><br><span class="line">   <span class="comment">//特性数组</span></span><br><span class="line">   objc_property_attribute_t attributes[] =&#123;attribute1,attribute2,attribute3,attribute4&#125;;</span><br><span class="line">   <span class="comment">//向People类中添加名为name的属性,属性的4个特性包含在attributes中</span></span><br><span class="line">   class_addProperty(People, <span class="string">"name"</span>, attributes, <span class="number">4</span>);</span><br><span class="line">   <span class="comment">//获取类中的属性列表</span></span><br><span class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> propertyCount;</span><br><span class="line">   objc_property_t * properties = class_copyPropertyList(People, &amp;propertyCount);</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;propertyCount; i++) &#123;</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"属性的名称为 : %s"</span>,property_getName(properties[i]));</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"属性的特性字符串为: %s"</span>,property_getAttributes(properties[i]));</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//释放属性列表数组</span></span><br><span class="line">   free(properties);</span><br></pre></td></tr></table></figure>


<p>参考:</p>
<p><a href="http://husbandman.diandian.com/post/2012-08-15/40036722785" target="_blank" rel="noopener">ObjC底层数据类型</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2014/08/17/objcruntime-explore2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/08/17/objcruntime-explore2/" class="post-title-link" itemprop="url">objc/runtime 探索(二)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2014-08-17 00:00:00" itemprop="dateCreated datePublished" datetime="2014-08-17T00:00:00Z">2014-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">develop</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2014/08/17/objcruntime-explore2/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2014/08/17/objcruntime-explore2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>接上次的话题,继续就<code>objc/runtime</code>进行讨论.<br>经过今晚的探究,基本掌握了运行时的函数规则,总的有如下几种函数前缀.<br>在后边的文章中我会就一些问题再次讨论,本文权当做API的速查手册使用.</p>
<ul>
<li>objc_</li>
<li>class_</li>
<li>object_</li>
<li>method_</li>
<li>property_</li>
<li>protocol_</li>
<li>ivar_ ,sel_     ,imp_</li>
</ul>
<h3 id="1-objc-xxx-系列函数"><a href="#1-objc-xxx-系列函数" class="headerlink" title="1.objc_xxx 系列函数"></a>1.objc_xxx 系列函数</h3><table>
<thead>
<tr>
<th>函数名称</th>
<th>函数作用</th>
</tr>
</thead>
<tbody><tr>
<td><em><code>objc_getClass</code></em></td>
<td>获取Class对象</td>
</tr>
<tr>
<td><em><code>objc_getMetaClass</code></em></td>
<td>获取MetaClass对象</td>
</tr>
<tr>
<td><em><code>objc_allocateClassPair</code></em></td>
<td>分配空间,创建类(仅在 创建之后,注册之前 能够添加成员变量)</td>
</tr>
<tr>
<td><em><code>objc_registerClassPair</code></em></td>
<td>注册一个类(注册后方可使用该类创建对象)</td>
</tr>
<tr>
<td><em><code>objc_disposeClassPair</code></em></td>
<td>注销某个类</td>
</tr>
<tr>
<td><em><code>objc_allocateProtocol</code></em></td>
<td>开辟空间创建协议</td>
</tr>
<tr>
<td><em><code>objc_registerProtocol</code></em></td>
<td>注册一个协议</td>
</tr>
<tr>
<td><em><code>objc_constructInstance</code></em></td>
<td>构造一个实例对象(ARC下无效)</td>
</tr>
<tr>
<td><em><code>objc_destructInstance</code></em></td>
<td>析构一个实例对象(ARC下无效)</td>
</tr>
<tr>
<td><em><code>objc_setAssociatedObject</code></em></td>
<td>为实例对象关联对象</td>
</tr>
<tr>
<td><em><code>objc_getAssociatedObje*ct</code></em></td>
<td>获取实例对象的关联对象</td>
</tr>
<tr>
<td><em><code>objc_removeAssociatedObjects</code></em></td>
<td>清空实例对象的所有关联对象</td>
</tr>
<tr>
<td><em><code>objc_msgSend</code></em></td>
<td>发送ObjC消息</td>
</tr>
</tbody></table>
<p>-</p>
<p><strong><code>objc_</code>系列函数关注于宏观使用,如类与协议的空间分配,注册,注销等操作</strong></p>
<h3 id="2-class-xxx-系列函数"><a href="#2-class-xxx-系列函数" class="headerlink" title="2.class_xxx 系列函数"></a>2.class_xxx 系列函数</h3><table>
<thead>
<tr>
<th>函数名称</th>
<th>函数作用</th>
</tr>
</thead>
<tbody><tr>
<td><em><code>class_addIvar</code></em></td>
<td>为类添加实例变量</td>
</tr>
<tr>
<td><em><code>class_addProperty</code></em></td>
<td>为类添加属性</td>
</tr>
<tr>
<td><em><code>class_addMethod</code></em></td>
<td>为类添加方法</td>
</tr>
<tr>
<td><em><code>class_addProtocol</code></em></td>
<td>为类遵循协议</td>
</tr>
<tr>
<td><em><code>class_replaceMethod</code></em></td>
<td>替换类某方法的实现</td>
</tr>
<tr>
<td><em><code>class_getName</code></em></td>
<td>获取类名</td>
</tr>
<tr>
<td><em><code>class_isMetaClass</code></em></td>
<td>判断是否为元类</td>
</tr>
<tr>
<td><em><code>objc_getProtocol</code></em></td>
<td>获取某个协议</td>
</tr>
<tr>
<td><em><code>objc_copyProtocolList</code></em></td>
<td>拷贝在运行时中注册过的协议列表</td>
</tr>
<tr>
<td><em><code>class_getSuperclass</code></em></td>
<td>获取某类的父类</td>
</tr>
<tr>
<td><em><code>class_setSuperclass</code></em></td>
<td>设置某类的父类</td>
</tr>
<tr>
<td><em><code>class_getProperty</code></em></td>
<td>获取某类的属性</td>
</tr>
<tr>
<td><em><code>class_getInstanceVariable</code></em></td>
<td>获取实例变量</td>
</tr>
<tr>
<td><em><code>class_getClassVariable</code></em></td>
<td>获取类变量</td>
</tr>
<tr>
<td><em><code>class_getInstanceMethod</code></em></td>
<td>获取实例方法</td>
</tr>
<tr>
<td><em><code>class_getClassMethod</code></em></td>
<td>获取类方法</td>
</tr>
<tr>
<td><em><code>class_getMethodImplementation</code></em></td>
<td>获取方法的实现</td>
</tr>
<tr>
<td><em><code>class_getInstanceSize</code></em></td>
<td>获取类的实例的大小</td>
</tr>
<tr>
<td><em><code>class_respondsToSelector</code></em></td>
<td>判断类是否实现某方法</td>
</tr>
<tr>
<td><em><code>class_conformsToProtocol</code></em></td>
<td>判断类是否遵循某协议</td>
</tr>
<tr>
<td><em><code>class_createInstance</code></em></td>
<td>创建类的实例</td>
</tr>
<tr>
<td><em><code>class_copyIvarList</code></em></td>
<td>拷贝类的实例变量列表</td>
</tr>
<tr>
<td><em><code>class_copyMethodList</code></em></td>
<td>拷贝类的方法列表</td>
</tr>
<tr>
<td><em><code>class_copyProtocolList</code></em></td>
<td>拷贝类遵循的协议列表</td>
</tr>
<tr>
<td><em><code>class_copyPropertyList</code></em></td>
<td>拷贝类的属性列表</td>
</tr>
</tbody></table>
<p>-</p>
<p><strong><code>class_</code>系列函数关注于类的内部,如实例变量,属性,方法,协议等相关问题</strong></p>
<h3 id="3-object-xxx-系列函数"><a href="#3-object-xxx-系列函数" class="headerlink" title="3.object_xxx 系列函数"></a>3.object_xxx 系列函数</h3><table>
<thead>
<tr>
<th>函数名称</th>
<th>函数作用</th>
</tr>
</thead>
<tbody><tr>
<td><em><code>object_copy</code></em></td>
<td>对象copy(ARC无效)</td>
</tr>
<tr>
<td><em><code>object_dispose</code></em></td>
<td>对象释放(ARC无效)</td>
</tr>
<tr>
<td><em><code>object_getClassName</code></em></td>
<td>获取对象的类名</td>
</tr>
<tr>
<td><em><code>object_getClass</code></em></td>
<td>获取对象的Class</td>
</tr>
<tr>
<td><em><code>object_setClass</code></em></td>
<td>设置对象的Class</td>
</tr>
<tr>
<td><em><code>object_getIvar</code></em></td>
<td>获取对象中实例变量的值</td>
</tr>
<tr>
<td><em><code>object_setIvar</code></em></td>
<td>设置对象中实例变量的值</td>
</tr>
<tr>
<td><em><code>object_getInstanceVariable</code></em></td>
<td>获取对象中实例变量的值 (ARC中无效,使用<code>object_getIvar</code>)</td>
</tr>
<tr>
<td><em><code>object_setInstanceVariable</code></em></td>
<td>设置对象中实例变量的值 (ARC中无效,使用<code>object_setIvar</code>)</td>
</tr>
</tbody></table>
<p>-</p>
<p><strong><code>objcet_</code>系列函数关注于对象的角度,如实例变量</strong></p>
<h3 id="4-method-xxx-系列函数"><a href="#4-method-xxx-系列函数" class="headerlink" title="4.method_xxx 系列函数"></a>4.method_xxx 系列函数</h3><table>
<thead>
<tr>
<th>函数名称</th>
<th>函数作用</th>
</tr>
</thead>
<tbody><tr>
<td><em><code>method_getName</code></em></td>
<td>获取方法名</td>
</tr>
<tr>
<td><em><code>method_getImplementation</code></em></td>
<td>获取方法的实现</td>
</tr>
<tr>
<td><em><code>method_getTypeEncoding</code></em></td>
<td>获取方法的类型编码</td>
</tr>
<tr>
<td><em><code>method_getNumberOfArguments</code></em></td>
<td>获取方法的参数个数</td>
</tr>
<tr>
<td><em><code>method_copyReturnType</code></em></td>
<td>拷贝方法的返回类型</td>
</tr>
<tr>
<td><em><code>method_getReturnType</code></em></td>
<td>获取方法的返回类型</td>
</tr>
<tr>
<td><em><code>method_copyArgumentType</code></em></td>
<td>拷贝方法的参数类型</td>
</tr>
<tr>
<td><em><code>method_getArgumentType</code></em></td>
<td>获取方法的参数类型</td>
</tr>
<tr>
<td><em><code>method_getDescription</code></em></td>
<td>获取方法的描述</td>
</tr>
<tr>
<td><em><code>method_setImplementation</code></em></td>
<td>设置方法的实现</td>
</tr>
<tr>
<td><em><code>method_exchangeImplementations</code></em></td>
<td>替换方法的实现</td>
</tr>
</tbody></table>
<p>-</p>
<p><strong><code>method_</code>系列函数关注于方法内部,如果方法的参数及返回值类型和方法的实现</strong></p>
<h3 id="5-property-xxx-系列函数"><a href="#5-property-xxx-系列函数" class="headerlink" title="5.property_xxx 系列函数"></a>5.property_xxx 系列函数</h3><table>
<thead>
<tr>
<th>函数名称</th>
<th>函数作用</th>
</tr>
</thead>
<tbody><tr>
<td><em><code>property_getName</code></em></td>
<td>获取属性名</td>
</tr>
<tr>
<td><em><code>property_getAttributes</code></em></td>
<td>获取属性的特性列表</td>
</tr>
<tr>
<td><em><code>property_copyAttributeList</code></em></td>
<td>拷贝属性的特性列表</td>
</tr>
<tr>
<td><em><code>property_copyAttributeValue</code></em></td>
<td>拷贝属性中某特性的值</td>
</tr>
</tbody></table>
<p>-</p>
<p><strong><code>property_</code>系类函数关注与属性*内部,如属性的特性等</strong></p>
<h3 id="6-protocol-xxx-系列函数"><a href="#6-protocol-xxx-系列函数" class="headerlink" title="6.protocol_xxx 系列函数"></a>6.protocol_xxx 系列函数</h3><table>
<thead>
<tr>
<th>函数名称</th>
<th>函数作用</th>
</tr>
</thead>
<tbody><tr>
<td><em><code>protocol_conformsToProtocol</code></em></td>
<td>判断一个协议是否遵循另一个协议</td>
</tr>
<tr>
<td><em><code>protocol_isEqual</code></em></td>
<td>判断两个协议是否一致</td>
</tr>
<tr>
<td><em><code>protocol_getName</code></em></td>
<td>获取协议名称</td>
</tr>
<tr>
<td><em><code>protocol_copyPropertyList</code></em></td>
<td>拷贝协议的属性列表</td>
</tr>
<tr>
<td><em><code>protocol_copyProtocolList</code></em></td>
<td>拷贝某协议所遵循的协议列表</td>
</tr>
<tr>
<td><em><code>protocol_copyMethodDescriptionList</code></em></td>
<td>拷贝协议的方法列表</td>
</tr>
<tr>
<td><em><code>protocol_addProtocol</code></em></td>
<td>为一个协议遵循另一协议</td>
</tr>
<tr>
<td><em><code>protocol_addProperty</code></em></td>
<td>为协议添加属性</td>
</tr>
<tr>
<td><em><code>protocol_getProperty</code></em></td>
<td>获取协议中的某个属性</td>
</tr>
<tr>
<td><em><code>protocol_addMethodDescription</code></em></td>
<td>为协议添加方法描述</td>
</tr>
<tr>
<td><em><code>protocol_getMethodDescription</code></em></td>
<td>获取协议中某方法的描述</td>
</tr>
</tbody></table>
<h3 id="7-ivar-xxx-系列函数"><a href="#7-ivar-xxx-系列函数" class="headerlink" title="7.ivar_xxx 系列函数"></a>7.ivar_xxx 系列函数</h3><table>
<thead>
<tr>
<th>函数名称</th>
<th>函数作用</th>
</tr>
</thead>
<tbody><tr>
<td><em><code>ivar_getName</code></em></td>
<td>获取Ivar名称</td>
</tr>
<tr>
<td><em><code>ivar_getTypeEncoding</code></em></td>
<td>获取类型编码</td>
</tr>
<tr>
<td><em><code>ivar_getOffset</code></em></td>
<td>获取偏移量</td>
</tr>
</tbody></table>
<h3 id="8-sel-xxx-系列函数"><a href="#8-sel-xxx-系列函数" class="headerlink" title="8.sel_xxx 系列函数"></a>8.sel_xxx 系列函数</h3><table>
<thead>
<tr>
<th>函数名称</th>
<th>函数作用</th>
</tr>
</thead>
<tbody><tr>
<td><em><code>sel_getName</code></em></td>
<td>获取名称</td>
</tr>
<tr>
<td><em><code>sel_getUid</code></em></td>
<td>注册方法</td>
</tr>
<tr>
<td><em><code>sel_registerName</code></em></td>
<td>注册方法</td>
</tr>
<tr>
<td><em><code>sel_isEqual</code></em></td>
<td>判断方法是否相等</td>
</tr>
</tbody></table>
<h3 id="9-imp-xxx-系列函数"><a href="#9-imp-xxx-系列函数" class="headerlink" title="9.imp_xxx 系列函数"></a>9.imp_xxx 系列函数</h3><table>
<thead>
<tr>
<th>函数名称</th>
<th>函数作用</th>
</tr>
</thead>
<tbody><tr>
<td><em><code>imp_implementationWithBlock</code></em></td>
<td>通过代码块创建IMP</td>
</tr>
<tr>
<td><em><code>imp_getBlock</code></em></td>
<td>获取函数指针中的代码块</td>
</tr>
<tr>
<td><em><code>imp_removeBlock</code></em></td>
<td>移除IMP中的代码块</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2014/08/15/objcruntime-explore1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/08/15/objcruntime-explore1/" class="post-title-link" itemprop="url">objc/runtime 探索(一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2014-08-15 00:00:00" itemprop="dateCreated datePublished" datetime="2014-08-15T00:00:00Z">2014-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">develop</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2014/08/15/objcruntime-explore1/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2014/08/15/objcruntime-explore1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近闲来无事,打算对<code>objc/runtime</code>进行一番研究,今晚把API翻了一遍,拿出了如下的一些有趣代码,本代码需事先导入部分<code>objc/runtime</code>中的头文件,如下所示</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;  </span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/message.h&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="动态创建类"><a href="#动态创建类" class="headerlink" title="动态创建类"></a>动态创建类</h3><blockquote>
<p>类的创建分为两步,添加<code>成员变量</code>需要在这两步操作之间,添加<code>成员方法</code>则无此要求  </p>
</blockquote>
<ol>
<li>Class <code>objc_allocateClassPair</code>(Class superClass,const char* className,size_t extraBytes);  </li>
<li>void objc_registerClassPair(Class cls); </li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开始类的定义</span></span><br><span class="line">Class Test= objc_allocateClassPair([NSObject class], <span class="string">"Test"</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//为类添加变量</span></span><br><span class="line">class_addIvar(Test, <span class="string">"_name"</span>, <span class="keyword">sizeof</span>(NSString*), log2(<span class="keyword">sizeof</span>(NSString*)), @encode(NSString*));</span><br><span class="line"><span class="comment">//为类添加方法</span></span><br><span class="line"><span class="comment">//1.注册名为 test: 的方法</span></span><br><span class="line">SEL s = sel_registerName(<span class="string">"test:"</span>);</span><br><span class="line"><span class="comment">//2.定义函数实现,此处的IMP是函数指针,原型为 typedef id (*IMP)(id, SEL, ...);</span></span><br><span class="line">IMP i = imp_implementationWithBlock(^(id <span class="keyword">this</span>,id some)&#123;</span><br><span class="line">    NSLog(@<span class="string">"%@"</span>,some);</span><br><span class="line">    <span class="keyword">return</span> @<span class="number">111</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//关联Test,s,i，并确认函数签名</span></span><br><span class="line">class_addMethod(Test, s, i, <span class="string">"i@:"</span>);</span><br><span class="line"><span class="comment">//结束类的定义</span></span><br><span class="line">objc_registerClassPair(Test);</span><br></pre></td></tr></table></figure>
<h3 id="动态创建对象"><a href="#动态创建对象" class="headerlink" title="动态创建对象"></a>动态创建对象</h3><blockquote>
<p>采用上边代码创建的<code>Test</code>类创建对象,并通过该对象操作成员方法和成员变量</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建对象</span></span><br><span class="line"><span class="keyword">id</span> t = [[Test alloc]init];</span><br><span class="line"><span class="comment">//KVC 动态改变 对象t 中的实例变量</span></span><br><span class="line">[t setValue:<span class="string">@"张三"</span> forKey:<span class="string">@"name"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[t valueForKey:<span class="string">@"name"</span>]);</span><br><span class="line"><span class="comment">//调用 t 对象中的 s 方法选择器对于的方法</span></span><br><span class="line"><span class="keyword">id</span> result = objc_msgSend(t, s,<span class="string">@"传送内容"</span>);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,result);</span><br></pre></td></tr></table></figure>
<h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">11</span>:<span class="number">00.239</span> Test[<span class="number">44644</span>:<span class="number">303</span>] 张三</span><br><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">11</span>:<span class="number">00.240</span> Test[<span class="number">44644</span>:<span class="number">303</span>] 传送内容</span><br><span class="line"><span class="number">2014</span><span class="number">-08</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">11</span>:<span class="number">00.241</span> Test[<span class="number">44644</span>:<span class="number">303</span>] <span class="number">111</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.devwu.com/2014/08/15/variadic-param/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Geek5Nan">
      <meta itemprop="description" content="每天进步一点。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Geek5Nan">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/08/15/variadic-param/" class="post-title-link" itemprop="url">变长参数的讨论</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2014-08-15 00:00:00" itemprop="dateCreated datePublished" datetime="2014-08-15T00:00:00Z">2014-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 14:04:51" itemprop="dateModified" datetime="2019-12-11T14:04:51Z">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/develop/" itemprop="url" rel="index"><span itemprop="name">develop</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2014/08/15/variadic-param/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2014/08/15/variadic-param/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>888</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一直以来对变长参数都比较好奇,索性花时间解解痒.</p>
<h3 id="先从数组指针来看"><a href="#先从数组指针来看" class="headerlink" title="先从数组指针来看"></a>先从数组指针来看</h3><pre><code>void test1(int* arr,int count)
{
    int sum = 0;
    for (int *p = arr; p &lt; arr + count; p++)
    {
        sum = sum+ *p;
    } 
    printf(&quot;%d\n&quot;,sum );
}</code></pre><p>代码较为简单,此处不再展开.</p>
<h3 id="接下来是可变参数"><a href="#接下来是可变参数" class="headerlink" title="接下来是可变参数"></a>接下来是可变参数</h3><blockquote>
<p>可变参数需要使用 <code>&lt;stdarg.h&gt;</code> 头文件,请提前导入</p>
</blockquote>
<ol>
<li>什么是可变参数?<ul>
<li>可变参数是函数或方法中形如<code>int show(int a,...)</code>这样的的参数  </li>
</ul>
</li>
<li>可变参数的相关规定<ul>
<li><code>...</code> 不能单独出现,且只能放在参数列表中的最后</li>
<li>变长参数的类型没有限定,使用时最好统一类型,避免类型安全问题</li>
<li>变长参数的个数没有限定,调用时一般以<code>0x00</code>即 <code>NULL/nil</code>结尾</li>
</ul>
</li>
</ol>
<p>-</p>
<pre><code>void test2(int a,...)
{
    int sum = a;
    //声明变长参数列表vl
    va_list vl;
    //va_start :将变长参数的前一个参数的地址存入vl
    va_start(vl,a);
    int next;
    //va_arg   :将vl向后偏移sizeof(int),并返回偏移后长度为sizeof(int)的数据
    //判断 next 是否为 0x00 ,如果不为 0x00 则继续遍历
    while( (next = va_arg(vl,int)) )
    {
        sum+= next;
    }
    //释放变长参数列表vl
    va_end(vl);
    printf(&quot;%d\n&quot;,sum );
}</code></pre><h3 id="调用形式"><a href="#调用形式" class="headerlink" title="调用形式"></a>调用形式</h3><pre><code>int main(int argc,char * args[])
{    
    int arr[] = {1,2,3,4,5};
    //数组指针
    test1(arr,5);
    printf(&quot;---------\n&quot;);
    //变长参数
    test2(1,2,3,4,5,6,NULL);
    return 0;
}</code></pre><h3 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果"></a>输出结果</h3><pre><code>15
---------
21</code></pre><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><code>...</code> 的类型不做限定,因此在函数或方法调用时可传递任何类型,包括但不限于<code>ObjC</code>中使用的<code>id</code>等类型</p>
<p>另外暂未查看到<code>&lt;stdarg.h&gt;</code>的源码,只能推测其中也是使用的数组指针进行的处理.如有纰漏请批评指正.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Geek5Nan"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">Geek5Nan</p>
  <div class="site-description" itemprop="description">每天进步一点。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/geek5nan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;geek5nan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/geek5nan" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;geek5nan" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2013 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Geek5Nan</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">116k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:45</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css">


  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://geek5nan.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
